/**
 * [OEUI] (C)2010-2099 oelove.com biz
 * Email: service@phpcoo.com ,phpcoo@qq.com
 * $ Last update 2020.12.22 by bo $
*/
(function(){"use strict";function l(t,i){if(i!=null&&typeof Symbol!=="undefined"&&i[Symbol.hasInstance]){return!!i[Symbol.hasInstance](t)}else{return t instanceof i}}function r(t){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){r=function t(i){return typeof i}}else{r=function t(i){return i&&typeof Symbol==="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i}}return r(t)}var t=[];var i=[];var e=function(){function t(t){var i={type:"dist",dataType:"1"};this.option=$.extend({},i,t);this.el=this.option.el;this.province=this.el.find(".province");this.city=this.el.find(".city");this.district=this.el.find(".district");this.dataArr=[];this.dist1="";this.dist2="";this.dist3="";this.init()}var i=t.prototype;i.init=function t(){this.setDefault();this.show();this.requestFirstDist();this.bindSelectProvince();this.bindSelectCity();this.bindSelectDistrict();this.switchDist()};i.setDefault=function t(){var i=this.el.find("input:nth-child(1)").val()||"";var e=this.el.find("input:nth-child(2)").val()||"";var s=this.el.find("input:nth-child(3)").val()||"";this.dist1=i!="0"?i:"";this.dist2=e!="0"?e:"";this.dist3=s!="0"?s:""};i.show=function t(){var i=this;var e=window.innerWidth;var s=this.el.offset().left;this.el.on("mouseenter",function(){if(+s+582>e){i.el.find(".list").css({left:"auto",right:"0"})}else{}i.el.find(".list").show()}).on("mouseleave",function(){i.el.find(".list").hide().css({left:"0",right:"auto"})})};i.loadProvinceHttp=function t(){return new Promise(function(e,i){$.ajax({type:"POST",url:_ROOT_PATH+"index.php/area/getlist",data:{},success:function t(i){e(i)},error:function t(){i()}})})};i.requestFirstDist=function t(){var n=this;var a=this;if(this.option.dataType=="1"){this.loadProvinceHttp().then(function(t){var i=r(t)=="object"?t:JSON.parse(t);if(i.response=="1"){var e="";if(l(i.result,Array)){var s="";i.result.forEach(function(t){e+='\n                                <div class="item">\n                                  <div class="box'+(n.dist1==t.areaid?" current":"")+'" data-value="'+t.areaid+'" data-text="'+t.areaname+'">'+t.areaname+"</div>\n                                </div>\n                              ";if(n.dist1){n.dist1==t.areaid&&(s=t.areaname)}});n.province.html(e);if(n.dist1){if(n.dist2==""){n.requestCity(n.dist1,function(t){if(l(t,Array)&&t.length>0){n.el.find(".selection span:nth-child(1)").html(s).addClass("current");n.el.find(".tab_nav .item:nth-child(1)").html(s).next().addClass("current").siblings().removeClass("current")}else{n.el.find(".selection span:nth-child(1)").html(s).addClass("current");n.el.find(".tab_nav .item:nth-child(1)").html(s).addClass("current").siblings().removeClass("current")}})}else{n.el.find(".selection span:nth-child(1)").html(s).addClass("current");n.el.find(".tab_nav .item:nth-child(1)").html(s)}}if(n.dist2){n.requestCity(n.dist1,function(){if(n.dist3){n.requestDist(n.dist2)}})}}}else{if(i.result){OEUI.message.msg({text:i.result})}else{OEUI.message.msg({text:"地区数据获取失败"})}}}).catch(function(){OEUI.message.msg({text:"地区数据获取失败"})})}else if(this.option.dataType=="2"){this.loadPickerData().then(function(t){var i=JSON.parse(t);if(i.response=="1"){if(a.option.unlimited){i.result=a.addUnlimited(i.result)}a.formatAddr(i.result);var e="";if(l(i.result,Array)){var s="";i.result.forEach(function(t){e+='\n                                <div class="item">\n                                  <div class="box'+(n.dist1==t.value?" current":"")+'" data-value="'+t.value+'" data-text="'+t.text+'">'+t.text+"</div>\n                                </div>\n                              ";if(n.dist1){n.dist1==t.value&&(s=t.text)}});n.province.html(e);if(n.dist1){if(n.dist2==""){if(l(n.dataArr[n.dist1],Array)&&n.dataArr[n.dist1].length>0){n.renderCity(n.dataArr[n.dist1]);n.el.find(".selection span:nth-child(1)").html(s).addClass("current");n.el.find(".tab_nav .item:nth-child(1)").html(s).next().addClass("current").siblings().removeClass("current")}else{n.el.find(".selection span:nth-child(1)").html(s).addClass("current");n.el.find(".tab_nav .item:nth-child(1)").html(s).addClass("current").siblings().removeClass("current")}}else{n.el.find(".selection span:nth-child(1)").html(s).addClass("current");n.el.find(".tab_nav .item:nth-child(1)").html(s)}}if(n.dist2){n.renderCity(n.dataArr[n.dist1])}if(n.dist3){n.renderDist(n.dataArr[n.dist2])}}}else{if(i.result){OEUI.message.msg({text:i.result})}else{OEUI.message.msg({text:"地区数据获取失败"})}}}).catch(function(){OEUI.message.msg({text:"地区数据获取失败"})})}};i.bindSelectProvince=function t(){var n=this;this.province.on("click",".box",function(t){var i=$(this);var e=i.attr("data-value");var s=i.attr("data-text");i.addClass("current").parent().siblings().find(".current").removeClass("current");n.setSelectedValue(e,"","",s,"","");n.requestCity(e)})};i.loadDistHttp=function t(s){return new Promise(function(e,i){$.ajax({type:"POST",url:_ROOT_PATH+"index.php/area/getlist",data:{parentid:s},success:function t(i){e(i)},error:function t(){i()}})})};i.requestCity=function t(i,e){var s=this;if(this.option.dataType=="1"){this.loadDistHttp(i).then(function(t){var i=r(t)=="object"?t:JSON.parse(t);if(i.response=="1"){s.renderCity(i.result)}else{if(i.result){OEUI.message.msg({text:i.result})}else{OEUI.message.msg({text:"地区数据获取失败"})}}if(typeof e=="function")e()}).catch(function(){OEUI.message.msg({text:"地区数据获取失败"})})}else if(this.option.dataType=="2"){if(l(this.dataArr[i],Array)){if(this.dataArr[i].length==0){this.el.find(".list").hide();return}this.renderCity(this.dataArr[i]);if(typeof e=="function")e()}else{this.el.find(".list").hide()}}};i.bindSelectCity=function t(){var n=this;this.city.on("click",".box",function(t){var i=$(this);var e=i.attr("data-value");var s=i.attr("data-text");i.addClass("current").parent().siblings().find(".current").removeClass("current");n.setSelectedValue(n.dist1,e,"",n.dist1Text,s,"");n.requestDist(e)})};i.requestDist=function t(i,e){var s=this;if(this.option.dataType=="1"){this.loadDistHttp(i).then(function(t){var i=r(t)=="object"?t:JSON.parse(t);if(i.response=="1"){s.renderDist(i.result);if(typeof e=="function")e(i.result)}else{if(i.result){OEUI.message.msg({text:i.result})}else{OEUI.message.msg({text:"地区数据获取失败"})}}}).catch(function(){OEUI.message.msg({text:"地区数据获取失败"})})}else if(this.option.dataType=="2"){if(l(this.dataArr[i],Array)){if(this.dataArr[i].length==0){this.el.find(".list").hide();this.el.find(".district").html("");return}this.renderDist(this.dataArr[i])}else{this.el.find(".list").hide();this.el.find(".district").html("")}}};i.bindSelectDistrict=function t(){var n=this;this.district.on("click",".box",function(t){var i=$(this);var e=i.attr("data-value");var s=i.attr("data-text");i.addClass("current").parent().siblings().find(".current").removeClass("current");n.setSelectedValue(n.dist1,n.dist2,e,n.dist1Text,n.dist2Text,s);n.el.find(".list").hide()})};i.switchDist=function t(){var i=this;this.el.find(".tab_nav").on("click",".item",function(){var t=$(this).index();if(t==1&&i.dist1==""){OEUI.message.msg({text:"请选择省份"});return}if(t==2&&i.dist2==""){OEUI.message.msg({text:"请选择城市"});return}$(this).addClass("current").siblings().removeClass("current");i.el.find(".content").eq(t).show().siblings().hide()});this.el.find(".selection").on("click","span",function(){var t=$(this).index();i.el.find(".content").eq(t).show().siblings().hide();i.el.find(".tab_nav .item").eq(t).addClass("current").siblings().removeClass("current")})};i.setSelectedValue=function t(i,e,s,n,a,r){this.dist1=i;this.dist2=e;this.dist3=s;this.dist1Text=n;this.dist2Text=a;this.dist3Text=r;this.el.find("input:nth-child(1)").val(this.dist1);this.el.find("input:nth-child(2)").val(this.dist2);this.el.find("input:nth-child(3)").val(this.dist3);if(i){if(this.option.dataType=="2"&&l(this.dataArr[i],Array)&&this.dataArr[i].length>0){this.el.find(".tab_nav .item:nth-child(1)").html(n).next().addClass("current").siblings().removeClass("current");this.el.find(".selection span:nth-child(1)").html(n).addClass("current")}else{this.el.find(".tab_nav .item:nth-child(1)").html(n).addClass("current").siblings().removeClass("current");this.el.find(".selection span:nth-child(1)").html(n).addClass("current")}}else{this.el.find(".tab_nav .item:nth-child(1)").html("选择省份");this.el.find(".selection span:nth-child(1)").html("")}if(e){if(this.option.dataType=="2"&&l(this.dataArr[e],Array)&&this.dataArr[e].length>0){this.el.find(".tab_nav .item:nth-child(2)").html(a).next().addClass("current").siblings().removeClass("current");this.el.find(".selection span:nth-child(2)").html(a).addClass("current")}else{this.el.find(".tab_nav .item:nth-child(2)").html(a).addClass("current").siblings().removeClass("current");this.el.find(".selection span:nth-child(2)").html(a).addClass("current")}}else{this.el.find(".tab_nav .item:nth-child(2)").html("选择城市");this.el.find(".selection span:nth-child(2)").html("")}if(s){this.el.find(".tab_nav .item:nth-child(3)").html(r).addClass("current").siblings().removeClass("current");this.el.find(".selection span:nth-child(3)").html(r).addClass("current")}else{this.el.find(".tab_nav .item:nth-child(3)").html("选择地区");this.el.find(".selection span:nth-child(3)").html("")}};i.loadPickerData=function t(){var s=this;return new Promise(function(e,i){$.ajax({url:_ROOT_PATH+"index.php",data:{c:"picker",a:s.option.type=="dist"?"area":"hometown"},success:function t(i){e(i)},error:function t(){i()}})})};i.formatAddr=function t(i){var e=this;$.each(i,function(t,i){e.dataArr[i.value]=i.children;if(i.children&&i.children.length){e.formatAddr(i.children)}})};i.addUnlimited=function t(i){var e=this;if(i&&l(i,Array)){i.unshift({text:e.option.unlimited,value:"0"})}i.forEach(function(t){if(t.children&&l(t.children,Array)){e.addUnlimited(t.children)}});return i};i.renderCity=function t(i){var e=this;var s="";if(l(i,Array)){var n="";i.forEach(function(t){s+='\n                    <div class="item">\n                      <div class="box'+(e.dist2==t.value?" current":"")+'" data-value="'+t.value+'" data-text="'+t.text+'">'+t.text+"</div>\n                    </div>\n                  ";if(e.dist2){e.dist2==t.value&&(n=t.text)}});this.city.html(s).show().siblings().hide();if(this.dist2){this.dist2Text=n;if(this.dist3==""){if(this.option.dataType=="1"){this.requestDist(this.dist2,function(t){if(l(t,Array)&&t.length>0){e.el.find(".selection span:nth-child(2)").html(n).addClass("current");e.el.find(".tab_nav .item:nth-child(2)").html(n).next().addClass("current").siblings().removeClass("current")}else{e.el.find(".selection span:nth-child(2)").html(n).addClass("current");e.el.find(".tab_nav .item:nth-child(2)").html(n).addClass("current").siblings().removeClass("current")}})}else if(this.option.dataType=="2"){if(l(this.dataArr[this.dist2],Array)&&this.dataArr[this.dist2].length>0){this.renderDist(this.dataArr[this.dist2]);this.el.find(".selection span:nth-child(2)").html(n).addClass("current");this.el.find(".tab_nav .item:nth-child(2)").html(n).next().addClass("current").siblings().removeClass("current")}else{this.el.find(".selection span:nth-child(2)").html(n).addClass("current");this.el.find(".tab_nav .item:nth-child(2)").html(n).addClass("current").siblings().removeClass("current")}}}else{this.el.find(".selection span:nth-child(2)").html(n).addClass("current");this.el.find(".tab_nav .item:nth-child(2)").html(n)}}}};i.renderDist=function t(i){var e=this;var s="";if(l(i,Array)){var n="";i.forEach(function(t){s+='\n                    <div class="item">\n                      <div class="box'+(e.dist3==t.value?" current":"")+'" data-value="'+t.value+'" data-text="'+t.text+'">'+t.text+"</div>\n                    </div>\n                  ";if(e.dist3){e.dist3==t.value&&(n=t.text)}});this.district.html(s).show().siblings().hide();if(this.dist3){this.dist3Text=n;this.el.find(".selection span:nth-child(3)").html(n).addClass("current");this.el.find(".tab_nav .item:nth-child(3)").html(n).addClass("current").siblings().removeClass("current")}}};return t}();window.Dist=e})();